{% extends 'base.html' %}

{% block title %}ACORN - SSH Test{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">SSH Connection Test</h1>
            
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Test SSH Connection</h5>
                </div>
                <div class="card-body">
                    <form method="post" action="{{ url_for('test_ssh_connection') }}">
                        {{ form.hidden_tag() }}
                        
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> 
                            This page allows you to test the SSH connectivity to the mock server.
                            It will verify that the application can connect and execute commands.
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Target Server</label>
                            <input type="text" class="form-control" value="localhost:2222 (Mock SSH Server)" disabled>
                            <div class="form-text">The test will use the mock SSH server running on port 2222</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Test Credentials</label>
                            <input type="text" class="form-control" value="test / Ac0rN$" disabled>
                            <div class="form-text">The test uses hardcoded credentials for the mock server</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Test Command</label>
                            <select name="command" class="form-select">
                                <option value="show version">show version</option>
                                <option value="show interface ge-0/0/0">show interface ge-0/0/0</option>
                                <option value="show circuit id TEST-001">show circuit id TEST-001</option>
                                <option value="show circuit id TEST-002">show circuit id TEST-002</option>
                                <option value="show circuit id TEST-999">show circuit id TEST-999</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Run Test</button>
                    </form>
                </div>
            </div>
            
            {% if result %}
            <div class="card mb-4">
                <div class="card-header {% if success %}bg-success{% else %}bg-danger{% endif %} text-white">
                    <h5 class="card-title mb-0">Test Results</h5>
                </div>
                <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">Status: {% if success %}Success{% else %}Failed{% endif %}</h6>
                    
                    {% if connection_time %}
                    <p><strong>Connection Time:</strong> {{ connection_time }}ms</p>
                    {% endif %}
                    
                    <div class="mb-3">
                        <label class="form-label">Command Output</label>
                        <pre class="bg-dark text-light p-3 rounded">{{ result }}</pre>
                    </div>
                    
                    {% if error %}
                    <div class="alert alert-danger">
                        <h6 class="alert-heading">Error Details</h6>
                        <p>{{ error }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="card-title mb-0">SSH Troubleshooting</h5>
                </div>
                <div class="card-body">
                    <p>If you encounter issues with the SSH connection, try the following:</p>
                    <ol>
                        <li>Ensure the SSH server is running (check the "SSH Server" workflow)</li>
                        <li>Verify that port 2222 is open and accessible</li>
                        <li>Check that the mock SSH server has the correct credentials</li>
                        <li>Review the logs for detailed error messages</li>
                    </ol>
                    
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        Remember that in a production environment, you'll need to use real network equipment 
                        credentials and IP addresses instead of the mock server.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}